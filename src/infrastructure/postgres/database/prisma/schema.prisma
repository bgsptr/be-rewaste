generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

model User {
  userId   String @id
  username String
  password String

  videos    Video[]
  bookmarks VideoBookmarked[]
  ratings   VideoRated[]
  histories VideoHistoryAndView[]
  comments  VideoComment[]
  UserRole  UserRole[]
}

model Role {
  roleId   String     @id
  name     String
  UserRole UserRole[]
}

model UserRole {
  userId String
  user   User   @relation(fields: [userId], references: [userId])
  roleId String
  role   Role   @relation(fields: [roleId], references: [roleId])

  @@id([userId, roleId])
}

model Video {
  videoId        String   @id
  title          String
  thumbnailUrl   String
  description    String
  url            String
  uploaderUserId String
  createdAt      DateTime
  updatedAt      DateTime

  uploader  User                  @relation(fields: [uploaderUserId], references: [userId])
  bookmarks VideoBookmarked[]
  ratings   VideoRated[]
  histories VideoHistoryAndView[]
  comments  VideoComment[]
}

model VideoBookmarked {
  userId       String
  videoId      String
  bookmarkedAt DateTime

  user  User  @relation(fields: [userId], references: [userId])
  video Video @relation(fields: [videoId], references: [videoId])

  @@id([userId, videoId])
}

model VideoRated {
  userId    String
  videoId   String
  score     Float
  createdAt DateTime

  user  User  @relation(fields: [userId], references: [userId])
  video Video @relation(fields: [videoId], references: [videoId])

  @@id([userId, videoId])
}

model VideoHistoryAndView {
  historyId String   @id
  userId    String
  videoId   String
  viewedAt  DateTime

  user  User  @relation(fields: [userId], references: [userId])
  video Video @relation(fields: [videoId], references: [videoId])
}

model VideoComment {
  commentId String   @id
  userId    String
  videoId   String
  content   String
  createdAt DateTime
  updatedAt DateTime

  user  User  @relation(fields: [userId], references: [userId])
  video Video @relation(fields: [videoId], references: [videoId])
}
